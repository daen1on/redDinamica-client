<div class="notifications-container" [ngClass]="{'is-page': isPageView}">
  <!-- Header de notificaciones -->
  <div class="notifications-header d-flex justify-content-between align-items-center px-3 py-2 bg-light border-bottom">
    <h6 class="mb-0 fw-bold text-dark">
      <a href="#" (click)="goToAllNotifications(); $event.preventDefault(); $event.stopPropagation()" class="text-decoration-none text-dark">
        <i class="fas fa-bell me-2 text-primary"></i>Notificaciones
      </a>
      <span *ngIf="unreadCount > 0" class="badge bg-danger ms-2 rounded-pill">{{unreadCount}}</span>
    </h6>
    <div class="dropdown" data-bs-auto-close="outside">
      <button class="btn btn-sm btn-outline-secondary dropdown-toggle border-0" type="button" data-bs-toggle="dropdown" aria-expanded="false" (click)="$event.stopPropagation()">
        <i class="fas fa-cog"></i>
      </button>
      <ul class="dropdown-menu dropdown-menu-end shadow">
        <li><a class="dropdown-item" href="#" (click)="markAllAsRead(); $event.preventDefault(); $event.stopPropagation()">
          <i class="fas fa-check-double me-2 text-success"></i>Marcar todas como leídas
        </a></li>
        <li><a class="dropdown-item" href="#" (click)="refreshNotifications(); $event.preventDefault(); $event.stopPropagation()">
          <i class="fas fa-sync-alt me-2 text-primary"></i>Actualizar
        </a></li>
      </ul>
    </div>
  </div>

  <!-- Loading state -->
  <div *ngIf="loading" class="text-center py-4">
    <div class="spinner-border spinner-border-sm text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-2 text-muted small mb-0">Cargando notificaciones...</p>
  </div>

  <!-- Error state -->
  <div *ngIf="error && !loading" class="alert alert-danger m-3 py-2">
    <i class="fas fa-exclamation-triangle me-2"></i>
    <small>{{error}}</small>
    <button class="btn btn-sm btn-outline-danger ms-2" (click)="refreshNotifications()">
      <i class="fas fa-redo-alt"></i>
    </button>
  </div>

  <!-- Empty state -->
  <div *ngIf="!loading && !error && notifications.length === 0" class="text-center py-4 px-3">
    <i class="fas fa-bell-slash fa-2x text-muted mb-2"></i>
    <h6 class="text-muted mb-1">No tienes notificaciones</h6>
    <p class="text-muted small mb-0">Las notificaciones aparecerán aquí cuando tengas actividad nueva.</p>
  </div>

  <!-- Notifications list -->
  <div *ngIf="!loading && !error && notifications.length > 0" class="notifications-list" (scroll)="onListScroll($event)">
    <div *ngFor="let notification of notifications; trackBy: trackByNotificationId" 
         class="notification-item d-flex px-3 py-2 border-bottom position-relative hover-bg-light"
         [class.bg-light]="!notification.read"
         [class.bg-white]="notification.read"
         (click)="onNotificationClick(notification)"
         style="cursor: pointer; transition: background-color 0.2s ease;">
      
      <!-- Notification icon -->
      <div class="notification-icon me-2 flex-shrink-0" style="width: 30px;">
        <i [ngClass]="[getNotificationIcon(notification.type), getNotificationColor(notification.type)]"
           style="font-size: 1.1em;"></i>
      </div>

      <!-- Notification content -->
      <div class="notification-content flex-grow-1 min-width-0">
        <div class="notification-title fw-semibold text-dark small" 
             style="line-height: 1.2; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
          {{notification.title}}
        </div>
        <div class="notification-text text-muted small" 
             style="line-height: 1.3; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical;">
          {{notification.content}}
        </div>
        <div class="notification-time text-muted small mt-1" style="font-size: 0.75em;">
          <i class="fas fa-clock me-1"></i>{{formatDate(notification.created_at)}}
        </div>
      </div>

      <!-- Unread indicator -->
      <div *ngIf="!notification.read" 
           class="unread-indicator bg-primary rounded-circle flex-shrink-0 ms-2" 
           style="width: 8px; height: 8px; margin-top: 4px;"></div>

      <!-- Actions -->
      <div class="notification-actions flex-shrink-0 ms-1">
        <div class="dropdown">
          <button class="btn btn-sm btn-ghost border-0 p-1" type="button" data-bs-toggle="dropdown" 
                  (click)="$event.stopPropagation()"
                  aria-expanded="false"
                  style="opacity: 0.6; transition: opacity 0.2s ease;">
            <i class="fas fa-ellipsis-v" style="font-size: 0.8em;"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end shadow-sm">
            <li *ngIf="!notification.read">
              <a class="dropdown-item small" href="#" 
                 (click)="markAsRead(notification); $event.preventDefault(); $event.stopPropagation()">
                <i class="fas fa-check me-2 text-success"></i>Marcar como leída
              </a>
            </li>
            <li>
              <a class="dropdown-item small text-danger" href="#" 
                 (click)="deleteNotification(notification); $event.preventDefault(); $event.stopPropagation()">
                <i class="fas fa-trash me-2"></i>Eliminar
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div *ngIf="notifications.length > 0" class="notifications-footer p-2 text-center border-top bg-light">
    <ng-container *ngIf="isPageView; else seeAll">
      <button *ngIf="hasMoreNotifications" 
              class="btn btn-sm btn-outline-primary" 
              (click)="loadMoreNotifications(); $event.stopPropagation()"
              [disabled]="loadingMore">
        <span *ngIf="!loadingMore">
          <i class="fas fa-plus me-1"></i>Cargar más
        </span>
        <span *ngIf="loadingMore">
          <div class="spinner-border spinner-border-sm me-1" role="status">
            <span class="visually-hidden">Cargando...</span>
          </div>
          Cargando más...
        </span>
      </button>
    </ng-container>
    <ng-template #seeAll>
      <button class="btn btn-sm btn-outline-primary" (click)="goToAllNotifications(); $event.stopPropagation()">
        <i class="fas fa-external-link-alt me-1"></i>Ver todas las notificaciones
      </button>
    </ng-template>
    <button class="btn btn-sm btn-outline-success ms-2" 
            (click)="refreshNotifications(); $event.stopPropagation()"
            [disabled]="loading">
      <i class="fas fa-sync-alt me-1" [class.fa-spin]="loading"></i>Actualizar
    </button>
  </div>
</div>
  