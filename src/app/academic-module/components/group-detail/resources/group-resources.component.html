<div class="tab-header d-flex align-items-center justify-content-between">
  <h3 class="m-0">Recursos del Grupo</h3>
  <button *ngIf="isGroupTeacher()" class="btn btn-success" (click)="openResourcesModal()">
    <i class="fas fa-plus"></i> Importar Recursos
  </button>
</div>

<div *ngIf="groupResources.length === 0" class="empty-state">
  <div class="empty-icon">
    <i class="fas fa-folder-open"></i>
  </div>
  <h4>Sin recursos</h4>
  <p>Importa recursos desde el repositorio.</p>
  <button *ngIf="isGroupTeacher()" class="btn btn-primary" (click)="openResourcesModal()">
    <i class="fas fa-plus"></i> Importar Recursos
  </button>
</div>

<!-- Resources List -->
<div *ngIf="groupResources.length > 0">
  <div *ngFor="let resource of groupResources" class="resource-item-card mb-3">
    <div class="card">
      <div class="card-body">
        <div class="row">
          <!-- Icon Column -->
          <div class="col-auto">
            <div class="text-center p-2 rounded-lg border border-light {{iconResource[resource.type]?.class}}" style="width: 80px; height: 80px; overflow:hidden">
              <i class="text-white fas {{iconResource[resource.type]?.icon}}" style="font-size:62px"></i>
            </div>
            <div class="mt-2">
              <button class="btn w-100 btn-sm" disabled title="Descargas">
                <i class="fas fa-download"></i> {{resource.downloads || 0}}
              </button>
            </div>
          </div>
          
          <!-- Content Column -->
          <div class="col">
            <h5 class="mt-0 text-truncate">
              <strong>{{resource.name}}</strong>
            </h5>
            <p>{{resource.description}}</p>
            <p><strong>Subido por:</strong></p>
            <div class="row">
              <div class="col-auto pe-0">
                <div class="flex-shrink-0 rounded-circle border-1 overflow-hidden" style="width: 40px; height:40px; background-color: aqua">
                  <img *ngIf="!resource.author?.picture" class="img-fluid" src="assets/images/user-default.png">
                  <img *ngIf="resource.author?.picture" class="img-fluid" [src]="url + 'get-image-user/' + resource.author.picture">
                </div>
              </div>
              <div class="col rounded px-2">
                <h6 class="mb-1">
                  <strong>{{resource.author?.name}} {{resource.author?.surname}}</strong>
                </h6>
              </div>
            </div>
          </div>
          
          <!-- Actions Column -->
          <div class="col-auto d-flex flex-column justify-content-center gap-2">
            <ng-container *ngIf="resource.type == 'link'; else getResource">
              <button class="btn btn-secondary" title="Ir al enlace" (click)="goToUrl(resource.url); increaseDownloads(resource)">
                <i class="fas fa-hand-pointer"></i> Abrir
              </button>
            </ng-container>
            <ng-template #getResource>
              <a class="btn btn-secondary" [title]="'Descargar: ' + resource.file" [href]="url + 'get-resource/' + resource.file" target="_blank" (click)="increaseDownloads(resource)">
                <i class="fas fa-download"></i> Descargar
              </a>
            </ng-template>
            <button *ngIf="isGroupTeacher()" class="btn btn-sm btn-outline-danger" (click)="removeResourceFromGroup(resource._id)">
              <i class="fas fa-times"></i> Remover
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de SelecciÃ³n de Recursos -->
<div *ngIf="showResourcesModal" class="resources-modal-overlay" (click)="closeResourcesModal()">
  <div class="resources-modal-container" (click)="$event.stopPropagation()">
    <div class="resources-modal-header">
      <h3 class="m-0">Importar Recursos al Grupo</h3>
      <button class="btn-close-modal" (click)="closeResourcesModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="resources-modal-body">
      <!-- Loading State -->
      <div *ngIf="loadingResources" class="text-center py-5">
        <div class="spinner-border" role="status">
          <span class="visually-hidden">Cargando recursos...</span>
        </div>
        <p class="mt-3 text-muted">Cargando recursos disponibles...</p>
      </div>

      <!-- Two Column Layout -->
      <div *ngIf="!loadingResources" class="row h-100">
        <!-- Left Column: Available Resources -->
        <div class="col-md-6 resources-column">
          <div class="column-header">
            <h5><i class="fas fa-folder-open me-2"></i>Recursos Disponibles ({{availableResources.length}})</h5>
          </div>
          <div class="resources-list">
            <div *ngIf="availableResources.length === 0" class="empty-state-small">
              <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
              <p class="text-muted">No hay recursos disponibles para importar</p>
            </div>
            
            <div *ngFor="let resource of availableResources" class="resource-item" 
                 [class.selected]="isResourceSelected(resource)"
                 (click)="toggleResourceSelection(resource)">
              <div class="d-flex align-items-start">
                <div class="resource-icon-small {{iconResource[resource.type]?.class}} me-3">
                  <i class="fas {{iconResource[resource.type]?.icon}}"></i>
                </div>
                <div class="flex-grow-1">
                  <h6 class="mb-1 resource-name">{{resource.name}}</h6>
                  <p class="mb-1 text-muted small resource-description">{{resource.description}}</p>
                  <div class="d-flex align-items-center gap-3 text-muted small">
                    <span><i class="fas fa-user"></i> {{resource.author?.name}}</span>
                    <span><i class="fas fa-download"></i> {{resource.downloads || 0}}</span>
                  </div>
                </div>
                <div class="resource-check">
                  <i *ngIf="isResourceSelected(resource)" class="fas fa-check-circle text-success"></i>
                  <i *ngIf="!isResourceSelected(resource)" class="far fa-circle"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Column: Selected Resources -->
        <div class="col-md-6 resources-column selection-column">
          <div class="column-header">
            <h5><i class="fas fa-check-square me-2"></i>Recursos Seleccionados ({{selectedResourcesToAdd.length}})</h5>
          </div>
          <div class="resources-list">
            <div *ngIf="selectedResourcesToAdd.length === 0" class="empty-state-small">
              <i class="fas fa-hand-pointer fa-3x text-muted mb-3"></i>
              <p class="text-muted">Haz clic en los recursos de la izquierda para seleccionarlos</p>
            </div>
            
            <div *ngFor="let resource of selectedResourcesToAdd" class="resource-item selected-item">
              <div class="d-flex align-items-start">
                <div class="resource-icon-small {{iconResource[resource.type]?.class}} me-3">
                  <i class="fas {{iconResource[resource.type]?.icon}}"></i>
                </div>
                <div class="flex-grow-1">
                  <h6 class="mb-1 resource-name">{{resource.name}}</h6>
                  <p class="mb-1 text-muted small resource-description">{{resource.description}}</p>
                  <div class="d-flex align-items-center gap-3 text-muted small">
                    <span><i class="fas fa-user"></i> {{resource.author?.name}}</span>
                    <span><i class="fas fa-download"></i> {{resource.downloads || 0}}</span>
                  </div>
                </div>
                <button class="btn-remove-selection" (click)="removeFromSelection(resource)">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="resources-modal-footer">
      <button class="btn btn-secondary" (click)="closeResourcesModal()">
        <i class="fas fa-times"></i> Cancelar
      </button>
      <button class="btn btn-success" 
              [disabled]="selectedResourcesToAdd.length === 0 || addingResource" 
              (click)="importSelectedResources()">
        <span *ngIf="addingResource" class="spinner-border spinner-border-sm me-2"></span>
        <i *ngIf="!addingResource" class="fas fa-download me-2"></i>
        Importar ({{selectedResourcesToAdd.length}})
      </button>
    </div>
  </div>
</div>

